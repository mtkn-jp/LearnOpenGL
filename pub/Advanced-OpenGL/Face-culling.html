<!DOCTYPE html>
<html lang="ja"> 
<head>
    <meta charset="utf-8"/>
    <title>LearnOpenGL</title>
    <link rel="shortcut icon" type="image/ico" href="/favicon.ico"  />
	<link rel="stylesheet" href="../static/style.css" />
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script>
	<script src="/static/functions.js"></script>
</head>
<body>
	<nav>
<ol>
	<li id="Introduction">
		<a href="https://learnopengl.com/Introduction">はじめに</a>
	</li>
	<li id="Getting-started">
		<span class="closed">入門</span>
		<ol>
			<li id="Getting-started/OpenGL">
				<a href="https://learnopengl.com/Getting-started/OpenGL">OpenGL </a>
			</li>
			<li id="Getting-started/Creating-a-window">
				<a href="https://learnopengl.com/Getting-started/Creating-a-window">ウィンドウの作成</a>
			</li>
			<li id="Getting-started/Hello-Window">
				<a href="https://learnopengl.com/Getting-started/Hello-Window">最初のウィンドウ</a>
			</li>
			<li id="Getting-started/Hello-Triangle">
				<a href="https://learnopengl.com/Getting-started/Hello-Triangle">最初の三角形</a>
			</li>
			<li id="Getting-started/Shaders">
				<a href="https://learnopengl.com/Getting-started/Shaders">シェーダー</a>
			</li>
			<li id="Getting-started/Textures">
				<a href="https://learnopengl.com/Getting-started/Textures">テクスチャ</a>
			</li>
			<li id="Getting-started/Transformations">
				<a href="https://learnopengl.com/Getting-started/Transformations">座標変換</a>
			</li>
			<li id="Getting-started/Coordinate-Systems">
				<a href="https://learnopengl.com/Getting-started/Coordinate-Systems">座標系</a>
			</li>
			<li id="Getting-started/Camera">
				<a href="https://learnopengl.com/Getting-started/Camera">カメラ</a>
			</li>
			<li id="Getting-started/Review">
				<a href="https://learnopengl.com/Getting-started/Review">まとめ</a>
			</li>
		</ol>
	</li>
	<li id="Lighting">
		<span class="closed">Lighting </span>
		<ol>
			<li id="Lighting/Colors">
				<a href="https://learnopengl.com/Lighting/Colors">Colors </a>
			</li>
			<li id="Lighting/Basic-Lighting">
				<a href="https://learnopengl.com/Lighting/Basic-Lighting">Basic Lighting </a>
			</li>
			<li id="Lighting/Materials">
				<a href="https://learnopengl.com/Lighting/Materials">Materials </a>
			</li>
			<li id="Lighting/Lighting-maps">
				<a href="https://learnopengl.com/Lighting/Lighting-maps">Lighting maps </a>
			</li>
			<li id="Lighting/Light-casters">
				<a href="https://learnopengl.com/Lighting/Light-casters">Light casters </a>
			</li>
			<li id="Lighting/Multiple-lights">
				<a href="https://learnopengl.com/Lighting/Multiple-lights">Multiple lights </a>
			</li>
			<li id="Lighting/Review">
				<a href="https://learnopengl.com/Lighting/Review">Review </a>
			</li>
		</ol>
	</li>
	<li id="Model-Loading">
		<span class="closed">Model Loading </span>
		<ol>
			<li id="Model-Loading/Assimp">
				<a href="https://learnopengl.com/Model-Loading/Assimp">Assimp </a>
			</li>
			<li id="Model-Loading/Mesh">
				<a href="https://learnopengl.com/Model-Loading/Mesh">Mesh </a>
			</li>
			<li id="Model-Loading/Model">
				<a href="https://learnopengl.com/Model-Loading/Model">Model </a>
			</li>
		</ol>
	</li>
	<li id="Advanced-OpenGL">
		<span class="closed">Advanced OpenGL </span>
		<ol>
			<li id="Advanced-OpenGL/Depth-testing">
				<a href="https://learnopengl.com/Advanced-OpenGL/Depth-testing">Depth testing </a>
			</li>
			<li id="Advanced-OpenGL/Stencil-testing">
				<a href="https://learnopengl.com/Advanced-OpenGL/Stencil-testing">Stencil testing </a>
			</li>
			<li id="Advanced-OpenGL/Blending">
				<a href="https://learnopengl.com/Advanced-OpenGL/Blending">Blending </a>
			</li>
			<li id="Advanced-OpenGL/Face-culling">
				<a href="https://learnopengl.cm/Advanced-OpenGL/Face-culling">Face culling </a>
			</li>
			<li id="Advanced-OpenGL/Framebuffers">
				<a href="https://learnopengl.com/Advanced-OpenGL/Framebuffers">Framebuffers </a>
			</li>
			<li id="Advanced-OpenGL/Cubemaps">
				<a href="https://learnopengl.com/Advanced-OpenGL/Cubemaps">Cubemaps </a>
			</li>
			<li id="Advanced-OpenGL/Advanced-Data">
				<a href="https://learnopengl.com/Advanced-OpenGL/Advanced-Data">Advanced Data </a>
			</li>
			<li id="Advanced-OpenGL/Advanced-GLSL">
				<a href="https://learnopengl.com/Advanced-OpenGL/Advanced-GLSL">Advanced GLSL </a>
			</li>
			<li id="Advanced-OpenGL/Geometry-Shader">
				<a href="https://learnopengl.com/Advanced-OpenGL/Geometry-Shader">Geometry Shader </a>
			</li>
			<li id="Advanced-OpenGL/Instancing">
				<a href="https://learnopengl.com/Advanced-OpenGL/Instancing">Instancing </a>
			</li>
			<li id="Advanced-OpenGL/Anti-Aliasing">
				<a href="https://learnopengl.com/Advanced-OpenGL/Anti-Aliasing">Anti Aliasing </a>
			</li>
		</ol>
	</li>
	<li id="Advanced-Lighting">
		<span class="closed">Advanced Lighting </span>
		<ol>
			<li id="Advanced-Lighting/Advanced-Lighting">
				<a href="https://learnopengl.com/Advanced-Lighting/Advanced-Lighting">Advanced Lighting </a>
			</li>
			<li id="Advanced-Lighting/Gamma-Correction">
				<a href="https://learnopengl.com/Advanced-Lighting/Gamma-Correction">Gamma Correction </a>
			</li>
			<li id="Advanced-Lighting/Shadows">
				<span class="closed">Shadows </span>
				<ol>
					<li id="Advanced-Lighting/Shadows/Shadow-Mapping">
						<a href="https://learnopengl.com/Advanced-Lighting/Shadows/Shadow-Mapping">Shadow Mapping </a>
					</li>
					<li id="Advanced-Lighting/Shadows/Point-Shadows">
						<a href="https://learnopengl.com/Advanced-Lighting/Shadows/Point-Shadows">Point Shadows </a>
					</li>
				</ol>
			</li>
			<li id="Advanced-Lighting/Normal-Mapping">
				<a href="https://learnopengl.com/Advanced-Lighting/Normal-Mapping">Normal Mapping </a>
			</li>
			<li id="Advanced-Lighting/Parallax-Mapping">
				<a href="https://learnopengl.com/Advanced-Lighting/Parallax-Mapping">Parallax Mapping </a>
			</li>
			<li id="Advanced-Lighting/HDR">
				<a href="https://learnopengl.com/Advanced-Lighting/HDR">HDR </a>
			</li>
			<li id="Advanced-Lighting/Bloom">
				<a href="https://learnopengl.com/Advanced-Lighting/Bloom">Bloom </a>
			</li>
			<li id="Advanced-Lighting/Deferred-Shading">
				<a href="https://learnopengl.com/Advanced-Lighting/Deferred-Shading">Deferred Shading </a>
			</li>
			<li id="Advanced-Lighting/SSAO">
				<a href="https://learnopengl.com/Advanced-Lighting/SSAO">SSAO </a>
			</li>
		</ol>
	</li>
	<li id="PBR">
		<span class="closed">PBR </span>
		<ol>
			<li id="PBR/Theory">
				<a href="https://learnopengl.com/PBR/Theory">Theory </a>
			</li>
			<li id="PBR/Lighting">
				<a href="https://learnopengl.com/PBR/Lighting">Lighting </a>
			</li>
			<li id="PBR/IBL">
				<span class="closed">IBL </span>
				<ol>
					<li id="PBR/IBL/Diffuse-irradiance">
						<a href="https://learnopengl.com/PBR/IBL/Diffuse-irradiance">Diffuse irradiance </a>
					</li>
					<li id="PBR/IBL/Specular-IBL">
						<a href="https://learnopengl.com/PBR/IBL/Specular-IBL">Specular IBL </a>
					</li>
				</ol>
			</li>
		</ol>
	</li>
	<li id="In-Practice">
		<span class="closed">In Practice </span>
		<ol>
			<li id="In-Practice/Debugging">
				<a href="https://learnopengl.com/In-Practice/Debugging">Debugging </a>
			</li>
			<li id="In-Practice/Text-Rendering">
				<a href="https://learnopengl.com/In-Practice/Text-Rendering">Text Rendering </a>
			</li>
			<li id="In-Practice/2D-Game">
				<span class="closed">2D Game </span>
				<ol>
					<li id="In-Practice/2D-Game/Breakout">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Breakout">Breakout </a>
					</li>
					<li id="In-Practice/2D-Game/Setting-up">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Setting-up">Setting up </a>
					</li>
					<li id="In-Practice/2D-Game/Rendering-Sprites">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Rendering-Sprites">Rendering Sprites </a>
					</li>
					<li id="In-Practice/2D-Game/Levels">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Levels">Levels </a>
					</li>
					<li id="In-Practice/2D-Game/Collisions">
						<span class="closed">Collisions </span>
						<ol>
							<li id="In-Practice/2D-Game/Collisions/Ball">
								<a href="https://learnopengl.com/In-Practice/2D-Game/Collisions/Ball">Ball </a>
							</li>
							<li id="In-Practice/2D-Game/Collisions/Collision-detection">
								<a href="https://learnopengl.com/In-Practice/2D-Game/Collisions/Collision-detection">Collision detection </a>
							</li>
							<li id="In-Practice/2D-Game/Collisions/Collision-resolution">
								<a href="https://learnopengl.com/In-Practice/2D-Game/Collisions/Collision-resolution">Collision resolution </a>
							</li>
						</ol>
					</li>
					<li id="In-Practice/2D-Game/Particles">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Particles">Particles </a>
					</li>
					<li id="In-Practice/2D-Game/Postprocessing">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Postprocessing">Postprocessing </a>
					</li>
					<li id="In-Practice/2D-Game/Powerups">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Powerups">Powerups </a>
					</li>
					<li id="In-Practice/2D-Game/Audio">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Audio">Audio </a>
					</li>
					<li id="In-Practice/2D-Game/Render-text">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Render-text">Render text </a>
					</li>
					<li id="In-Practice/2D-Game/Final-thoughts">
						<a href="https://learnopengl.com/In-Practice/2D-Game/Final-thoughts">Final thoughts </a>
					</li>
				</ol>
			</li>
		</ol>
	</li>
	<li id="Guest-Articles">
		<span class="closed">Guest Articles </span>
		<ol>
			<li id="Guest-Articles/How-to-publish">
				<a href="https://learnopengl.com/Guest-Articles/How-to-publish">How to publish </a>
			</li>
			<li id="Guest-Articles/2020">
				<span class="closed">2020 </span>
				<ol>
					<li id="Guest-Articles/2020/OIT">
						<span class="closed">OIT </span>
						<ol>
							<li id="Guest-Articles/2020/OIT/Introduction">
								<a href="https://learnopengl.com/Guest-Articles/2020/OIT/Introduction">Introduction </a>
							</li>
							<li id="Guest-Articles/2020/OIT/Weighted-Blended">
								<a href="https://learnopengl.com/Guest-Articles/2020/OIT/Weighted-Blended">Weighted Blended </a>
							</li>
						</ol>
					</li>
					<li id="Guest-Articles/2020/Skeletal-Animation">
						<a href="https://learnopengl.com/Guest-Articles/2020/Skeletal-Animation">Skeletal Animation </a>
					</li>
				</ol>
			</li>
			<li id="Guest-Articles/2021">
				<span class="closed">2021 </span>
				<ol>
					<li id="Guest-Articles/2021/CSM">
						<a href="https://learnopengl.com/Guest-Articles/2021/CSM">CSM </a>
					</li>
					<li id="Guest-Articles/2021/Scene">
						<span class="closed">Scene </span>
						<ol>
							<li id="Guest-Articles/2021/Scene/Scene-Graph">
								<a href="https://learnopengl.com/Guest-Articles/2021/Scene/Scene-Graph">Scene Graph </a>
							</li>
							<li id="Guest-Articles/2021/Scene/Frustum-Culling">
								<a href="https://learnopengl.com/Guest-Articles/2021/Scene/Frustum-Culling">Frustum Culling </a>
							</li>
						</ol>
					</li>
					<li id="Guest-Articles/2021/Tessellation">
						<span class="closed">Tessellation </span>
						<ol>
							<li id="Guest-Articles/2021/Tessellation/Height-map">
								<a href="https://learnopengl.com/Guest-Articles/2021/Tessellation/Height-map">Height map </a>
							</li>
						</ol>
					</li>
				</ol>
			</li>
		</ol>
	</li>
	<li id="Code-repository">
		<a href="https://learnopengl.com/Code-repository">Code repository </a>
	</li>
	<li id="Translations">
		<a href="https://learnopengl.com/Translations">Translations </a>
	</li>
	<li id="About">
		<a href="https://learnopengl.com/About">About </a>
	</li>
</ol>
	</nav>
	<main>
    <div id="content">
    <h1 id="content-title">Face culling</h1>
<h1 id="content-url" style='display:none;'>Advanced-OpenGL/Face-culling</h1>
<p>
  Try mentally visualizing a 3D cube and count the maximum number of faces you'll be able to see from any direction. If your imagination is not too creative you probably ended up with a maximum number of 3. You can view a cube from any position and/or direction, but you would never be able to see more than 3 faces. So why would we waste the effort of drawing those other 3 faces that we can't even see. If we could discard those in some way we would save more than 50% of this cube's total fragment shader runs!
</p>

<note>
  We say <em>more than 50%</em> instead of 50%, because from certain angles only 2 or even 1 face could be visible. In that case we'd save <strong>more</strong> than 50%.
</note>

<p>
  This is a really great idea, but there's one problem we need to solve: how do we know if a face of an object is not visible from the viewer's point of view? If we imagine any closed shape, each of its faces has two sides. Each side would either <em>face</em> the user or show its back to the user. What if we could only render the faces that are <em>facing</em> the viewer?
</p>

<p>
  This is exactly what <def>face culling</def> does. OpenGL checks all the faces that are <def>front facing</def> towards the viewer and renders those while discarding all the faces that are <def>back facing</def>, saving us a lot of fragment shader calls. We do need to tell OpenGL which of the faces we use are actually the front faces and which faces are the back faces. OpenGL uses a clever trick for this by analyzing the <def>winding order</def> of the vertex data.
</p>

<h2>Winding order</h2>
<p>
  When we define a set of triangle vertices we're defining them in a certain winding order that is either <def>clockwise</def> or <def>counter-clockwise</def>. Each triangle consists of 3 vertices and we specify those 3 vertices in a winding order as seen from the center of the triangle.
</p>

<img src="/img/advanced/faceculling_windingorder.png" class="clean" alt="Winding order of OpenGL triangles"/>

<p>
  As you can see in the image we first define vertex <code>1</code> and from there we can choose whether the next vertex is <code>2</code> or <code>3</code>. This choice defines the winding order of this triangle. The following code illustrates this:
</p>

<pre><code>
float vertices[] = {
    // clockwise
    vertices[0], // vertex 1
    vertices[1], // vertex 2
    vertices[2], // vertex 3
    // counter-clockwise
    vertices[0], // vertex 1
    vertices[2], // vertex 3
    vertices[1]  // vertex 2  
};
</code></pre>

<p>
  Each set of 3 vertices that form a triangle primitive thus contain a winding order. OpenGL uses this information when rendering your primitives to determine if a triangle is a <def>front-facing</def> or a <def>back-facing</def> triangle. By default, triangles defined with counter-clockwise vertices are processed as front-facing triangles.
</p>

<p>
  When defining your vertex order you visualize the corresponding triangle as if it was facing you, so each triangle that you're specifying should be counter-clockwise as if you're directly facing that triangle. The cool thing about specifying all your vertices like this is that the actual winding order is calculated at the rasterization stage, so when the vertex shader has already run. The vertices are then seen as from the <strong>viewer's point of view</strong>. 
</p>

<p>
  All the triangle vertices that the viewer is then facing are indeed in the correct winding order as we specified them, but the vertices of the triangles at the other side of the cube are now rendered in such a way that their winding order becomes reversed. The result is that the triangles we're facing are seen as front-facing triangles and the triangles at the back are seen as back-facing triangles. The following image shows this effect:
</p>

<img src="/img/advanced/faceculling_frontback.png" class="clean" alt="Image of viewer seeing front or back facing triangles"/>

<p>
  In the vertex data we defined both triangles in counter-clockwise order (the front and back triangle as 1, 2, 3). However, from the viewer's direction the back triangle is rendered clockwise if we draw it in the order of 1, 2 and 3 from the viewer's current point of view. Even though we specified the back triangle in counter-clockwise order, it is now rendered in a clockwise order. This is exactly what we  want to <def>cull</def> (discard) non-visible faces!
</p>

<h2>Face culling</h2>
<p>
  At the start of the chapter we said that OpenGL is able to discard triangle primitives if they're rendered as back-facing triangles. Now that we know how to set the winding order of the vertices we can start using OpenGL's <def>face culling</def> option which is disabled by default.  
</p>

<p>
  The cube vertex data we used in the previous chapters wasn't defined with the counter-clockwise winding order in mind, so I updated the vertex data to reflect a counter-clockwise winding order which you can copy from <a href="/code_viewer.php?code=advanced/faceculling_vertexdata" target="_blank">here</a>. It's a good practice to try and visualize that these vertices are indeed all defined in a counter-clockwise order for each triangle.
</p>

<p>
  To enable face culling we only have to enable OpenGL's <var>GL_CULL_FACE</var> option:
</p>

<pre><code>
<function id='60'>glEnable</function>(GL_CULL_FACE);  
</code></pre>

<p>
  From this point on, all the faces that are not front-faces are discarded (try flying inside the cube to see that all inner faces are indeed discarded). Currently we save over 50% of performance on rendering fragments if OpenGL decides to render the back faces first (otherwise depth testing would've discarded them already). Do note that this only really works with closed shapes like a cube. We do have to disable face culling again when we draw the grass leaves from the <a href="https://learnopengl.com/Advanced-OpenGL/Blending" target="_blank">previous</a> chapter, since their front <strong>and</strong> back face should be visible.
</p>

<p>
  OpenGL allows us to change the type of face we want to cull as well. What if we want to cull front faces and not the back faces? We can define this behavior with <fun><function id='74'>glCullFace</function></fun>:
</p>

<pre><code>
<function id='74'>glCullFace</function>(GL_FRONT);  
</code></pre>

<p>
  The <fun><function id='74'>glCullFace</function></fun> function has three possible options:
</p>

<ul>
  <li><var>GL_BACK</var>: Culls only the back faces.</li>
  <li><var>GL_FRONT</var>: Culls only the front faces.</li>
  <li><var>GL_FRONT_AND_BACK</var>: Culls both the front and back faces.</li>
</ul>

<p>
  The initial value of <fun><function id='74'>glCullFace</function></fun> is <var>GL_BACK</var>. We can also tell OpenGL we'd rather prefer clockwise faces as the front-faces instead of counter-clockwise faces via <fun><function id='75'>glFrontFace</function></fun>:
</p>

<pre><code>
<function id='75'>glFrontFace</function>(GL_CCW);  
</code></pre>

<p>
  The default value is <var>GL_CCW</var> that stands for counter-clockwise ordering with the other option being <var>GL_CW</var> which (obviously) stands for clockwise ordering.
</p>

<p>
  As a simple test we could reverse the winding order by telling OpenGL that the front-faces are now determined by a clockwise ordering instead of a counter-clockwise ordering:
</p>

<pre><code>
<function id='60'>glEnable</function>(GL_CULL_FACE);
<function id='74'>glCullFace</function>(GL_BACK);
<function id='75'>glFrontFace</function>(GL_CW);  
</code></pre>

<p>
  The result is that only the back faces are rendered:
</p>

<img src="/img/advanced/faceculling_reverse.png" class="clean" alt="Image of faceculling with clockwise ordering, only culling the front faces"/>

<p>
  Note that you can create the same effect by culling front faces with the default counter-clockwise winding order:
</p>

<pre><code>
<function id='60'>glEnable</function>(GL_CULL_FACE);
<function id='74'>glCullFace</function>(GL_FRONT);  
</code></pre>

<p>
  As you can see, face culling is a great tool for increasing performance of your OpenGL applications with minimal effort; especially as all 3D applications export models with consistent winding orders (CCW by default). You do have to keep track of the objects that will actually benefit from face culling and which objects shouldn't be culled at all. 
</p>

<h2>Exercises</h2>
<ul>
  <li>Can you re-define the vertex data by specifying each triangle in clockwise order and then render the scene with clockwise triangles set as the front faces: <a href="/code_viewer.php?code=advanced/faceculling-exercise1" target="_blank">solution</a></li>
</ul>       

    </div>
    
	</main>
</body>
</html>
